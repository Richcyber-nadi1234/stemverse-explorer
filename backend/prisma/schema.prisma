// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" // Change to "cockroachdb" if using CockroachDB specifically
  url      = env("DATABASE_URL")
}

// --------------------------------------
// USER MODEL
// Stores authentication, profile, roles, and gamification data
// --------------------------------------
model User {
  id             String   @id @default(uuid())
  email          String   @unique
  passwordHash   String
  firstName      String?
  lastName       String?
  bio            String?  @db.Text
  
  // Roles stored as a string array for flexibility (e.g., ["STUDENT", "ADMIN"])
  roles          String[] @default(["STUDENT"])

  // Gamification & Progress Stats
  xp             Int      @default(0)
  level          Int      @default(1)
  stars          Int      @default(0) // Currency earned (mentioned in pitch)
  badges         String[] @default([]) // Array of badge IDs or names
  
  // Avatar Configuration
  // Stored as JSON to handle complex customization (e.g., { hair: "style1", color: "blue", accessory: "glasses" })
  avatarConfig   Json?    

  // Relations
  coursesTeaching Course[] @relation("InstructorCourses")
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("users")
}

// --------------------------------------
// COURSE MODEL
// Stores metadata about the STEM courses
// --------------------------------------
model Course {
  id          String   @id @default(uuid())
  title       String
  description String   @db.Text
  thumbnailUrl String?
  
  // Categorization
  category    String   // e.g., "Robotics", "Coding", "Science"
  tags        String[] // e.g., ["Beginner", "Python", "Physics"]
  
  // Instructor Relation
  instructorId String
  instructor   User    @relation("InstructorCourses", fields: [instructorId], references: [id])

  // Content Relation
  modules     Module[]

  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("courses")
}

// --------------------------------------
// MODULE MODEL
// Specific chapters or units within a course
// --------------------------------------
model Module {
  id          String   @id @default(uuid())
  title       String
  description String?
  
  // Ordering logic to keep modules in sequence
  orderIndex  Int      @default(0) 

  // Content Data
  videoUrl    String?  // Link to the lesson video
  content     String?  @db.Text // Markdown text for reading materials
  
  // Relation to Course
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("modules")
}